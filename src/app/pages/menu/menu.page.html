<ion-content [fullscreen]="true">

  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-input [(ngModel)]="codigoInvitacion" placeholder="Ingrese código de invitación"></ion-input>
      <ion-button (click)="agregarListaPorCodigo()">Buscar materia</ion-button>
    </ion-toolbar>
  </ion-header>

  <!-- Resultado de búsqueda de materia por código -->
  <ion-card *ngIf="materiaBuscada">
    <ion-card-header>
      <ion-card-title>{{ materiaBuscada.nombre }}</ion-card-title>
      <ion-card-subtitle>{{ materiaBuscada.descripcion }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 8px;">
        <div>
          <p><strong>Profesor:</strong> {{ materiaBuscada.profesorNombre }} {{ materiaBuscada.profesorApellido }}</p>
          <p><strong>Código de invitación:</strong> {{ materiaBuscada.invitacion }}</p>
        </div>

      </div>
    </ion-card-content>
  </ion-card>

  <ion-content [fullscreen]="true">

    <ion-card class="contenedor-card">
      <ion-card-header>
        <ion-card-title>Materias Suscriptas</ion-card-title>
      </ion-card-header>

      <!-- Museta la lista de materias a la que el usuario esta suscripto -->
      -<ion-card-content class="contenedor-scroll">
        <p *ngIf="listaAsistCarga.length === 0">No hay listas para mostrar.</p>

        <ion-list>
          <ion-item *ngFor="let lista of listaAsistCarga">
            <ion-label>{{ lista.nombre }}</ion-label>
            <ion-label>{{ lista.invitacion }}</ion-label>
            <ion-chip shape="round" (click)="detalle(lista.nombre, listaAsist)">Ver<ion-icon
                name="enter-outline"></ion-icon></ion-chip>
            <ion-chip shape="round" (click)="eliminar(lista.nombre, listaAsist)">Eliminar Materia<ion-icon
                name="close-circle-outline"></ion-icon></ion-chip>
          </ion-item>
          <ion-button *ngIf="listaAsist.length > listaAsistCarga.length" horizontal="end"
            (click)="cargarMasListas()">Cargar más</ion-button>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Museta la lista de materias que el usuario logueado creo -->
    <ion-card class="contenedor-card">
      <ion-card-header>
        <ion-card-title>Materias Creadas</ion-card-title>
      </ion-card-header>
      <ion-card-content class="contenedor-scroll">
        <p *ngIf="materias.length === 0">No hay materias creadas.</p>
        <ion-list>
          <ion-item *ngFor="let materia of materias">
            <ion-label>{{ materia.nombre }}</ion-label>
            <ion-label>{{ materia.descripcion }}</ion-label>
            <ion-chip shape="round" (click)="detalleMateria(materia)">Ver<ion-icon name="enter-outline"></ion-icon>
            </ion-chip>
            <ion-chip color="danger" shape="round" (click)="eliminarMateria(materia)">
              Eliminar<ion-icon name="trash-outline"></ion-icon>
            </ion-chip>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Boton abrir el modal para crear una Materia -->
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
      <ion-fab-button color="primary" (click)="abrirModal()">
        <ion-icon name="add"></ion-icon>
      </ion-fab-button>
    </ion-fab>

    <!-- Con modal abierto se muestra esto -->
    <ion-modal [isOpen]="modalAbierto" (didDismiss)="cerrarModal()">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>Agregar nueva materia</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="cerrarModal()">
                <ion-icon slot="icon-only" name="close"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
          <ion-item>
            <ion-label position="floating">Nombre de la materia</ion-label>
            <ion-input [(ngModel)]="materiaForm.nombre"></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Descripción</ion-label>
            <ion-input [(ngModel)]="materiaForm.descripcion"></ion-input>
          </ion-item>
          <!-- Campos ocultos para guardar el usuario -->
          <ion-input type="hidden" [(ngModel)]="materiaForm.creadorId"></ion-input>
          <ion-input type="hidden" [(ngModel)]="materiaForm.profesorId"></ion-input>
          <ion-input type="hidden" [(ngModel)]="materiaForm.profesorNombre"></ion-input>
          <ion-input type="hidden" [(ngModel)]="materiaForm.profesorApellido"></ion-input>
          
          
          <!-- Llama a la funcion guardarMateria() que guarda el la materia en un array -->
          <ion-button expand="block" (click)="guardarMateria()">Guardar</ion-button>
        </ion-content>
      </ng-template>
    </ion-modal>

  </ion-content>