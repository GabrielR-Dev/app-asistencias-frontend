
<ion-content [fullscreen]="true" class="ion-padding">

  <!-- Header con buscador -->
  <ion-header>
    <ion-toolbar>
      <ion-title class="ion-text-center">Buscar Evento</ion-title>
    </ion-toolbar>
    <ion-toolbar>
      <ion-item lines="none">
        <ion-input [(ngModel)]="codigoInvitacion" placeholder="Código de invitación"></ion-input>
      </ion-item>
      <ion-button expand="block" (click)="agregarListaPorCodigo()">Buscar evento</ion-button>
    </ion-toolbar>
  </ion-header>

  <!-- Resultado búsqueda -->
  <ion-card *ngIf="eventoBuscado">
    <ion-card-header>
      <ion-card-title>{{ eventoBuscado.nombre }}</ion-card-title>
      <ion-card-subtitle>{{ eventoBuscado.descripcion }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Organizador:</strong> {{ eventoBuscado.organizadorNombre }} {{ eventoBuscado.organizadorApellido }}</p>
      <p><strong>Código de invitación:</strong> {{ eventoBuscado.codigoInvitacion }}</p>

      <ion-badge color="warning" *ngIf="esMiEvento">No puedes suscribirte a tu propio evento</ion-badge>
      <ion-badge color="primary" *ngIf="yaSuscripto && !esMiEvento">Ya estás suscripto a este evento</ion-badge>

      <ion-button expand="block" color="success" *ngIf="!esMiEvento && !yaSuscripto" (click)="suscribirseAEvento()">
        Suscribirse
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Mis Suscripciones -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Suscripciones</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p *ngIf="listaMisEventosSuscriptos.length === 0">No hay eventos suscriptos para mostrar.</p>
      <ion-list>
        <ion-item *ngFor="let eventoSuscripto of listaMisEventosSuscriptos">
          <ion-label class="ion-text-wrap">
            <h2>{{ eventoSuscripto.nombre }}</h2>
            <p><strong>Organizador:</strong> {{ eventoSuscripto.organizadorNombre }} {{ eventoSuscripto.organizadorApellido}}</p>
            <p *ngIf="eventoSuscripto.descripcion">{{ eventoSuscripto.descripcion }}</p>
            <p *ngIf="eventoSuscripto.creadorNombre">
              <strong>Creador:</strong> {{ eventoSuscripto.creadorNombre }} {{ eventoSuscripto.creadorApellido }}
            </p>
          </ion-label>
          <ion-buttons slot="end">
            <ion-button fill="clear" size="small" (click)="detalleSuscripto(eventoSuscripto)">
              <ion-icon name="enter-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button fill="clear" size="small" color="danger" (click)="desuscribirseDeEvento(eventoSuscripto.id)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Mis Eventos -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Mis Eventos</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p *ngIf="eventos.length === 0">No hay eventos creados.</p>
      <ion-list>
        <ion-item *ngFor="let evento of eventos">
          <ion-label class="ion-text-wrap">
            <h2>{{ evento.nombre }}</h2>
            <p>{{ evento.descripcion }}</p>
            <p *ngIf="evento.codigoInvitacion">
              <strong>Código:</strong> {{ evento.codigoInvitacion }}
              <ion-button size="small" fill="clear" (click)="copiarCodigo(evento.codigoInvitacion)">
                <ion-icon [name]="copiado ? 'checkmark-outline' : 'copy-outline'" slot="icon-only"></ion-icon>
              </ion-button>
            </p>
            <p *ngIf="evento.organizadorNombre"><strong>Organizador:</strong> {{ evento.organizadorNombre }} {{
              evento.organizadorApellido }}</p>
          </ion-label>
          <ion-buttons slot="end">
            <ion-button fill="clear" size="small" (click)="detalleEvento(evento)">
              <ion-icon name="enter-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button fill="clear" size="small" color="danger" (click)="eliminarEvento(evento)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Botón para crear evento -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="abrirModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Modal creación -->
  <ion-modal [isOpen]="modalAbierto" (didDismiss)="cerrarModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Agregar nuevo evento</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarModal()">
              <ion-icon slot="icon-only" name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="floating">Nombre del evento</ion-label>
          <ion-input [(ngModel)]="eventoForm.nombre"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="floating">Descripción</ion-label>
          <ion-input [(ngModel)]="eventoForm.descripcion"></ion-input>
        </ion-item>

        <ion-button expand="block" (click)="guardaEvento()">Guardar</ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>